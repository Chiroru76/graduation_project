<div class="block rounded-2xl bg-white shadow-sm ring-1 ring-black/5 px-5 py-2 hover:shadow md:px-6">
  <div class="flex items-center justify-between">
    <%= link_to edit_task_path(task), class: "flex items-center gap-4 flex-1 min-w-0" do %>
      <!-- 左：タイトル-->
      <div class="min-w-0 flex-1">
        <div class="text-base font-semibold text-gray-900 truncate">
          <%= task.title %>
        </div>
      </div>

       <!-- 中央：タグ -->
      <% if task.respond_to?(:tag) && task.tag.present? %>
        <span class="hidden whitespace-nowrap rounded-lg bg-blue-100 px-3 py-1 text-xs font-bold tracking-wider text-pink-500 md:inline-block">
          <%= task.tag %>
        </span>
      <% end %>
       <!-- 中央：目標 -->
      <% if task.target_value.present? && task.target_unit.present? && task.target_period.present? %>
        <span class="text-sm text-gray-600">目標：
        <%= task.target_value %>
        <%= t("enums.task.target_unit.#{task.target_unit}") %> /
        <%= t("enums.task.target_period.#{task.target_period}") %>
        </span>
      <% end %>
    <% end %>

    <!-- 右：操作（checkbox or log） -->
    <div class="shrink-0 ml-4">
      <% if task.todo? || (task.habit? && task.checkbox?) %>
        <%= form_with model: task, url: complete_task_path(task), method: :patch, html: { class: "inline-block" } do |f| %>
          <%= f.check_box :status,
              { class: "h-9 w-9 rounded-lg border-2 border-gray-300
                        text-green-500 focus:ring-2 focus:ring-green-400",
                onclick: "event.stopPropagation(); this.form.requestSubmit();"
              },
              "done",
              "open"
          %>
        <% end %>
      <% elsif task.habit? && task.log? %>
        <div data-controller="modal">
          <button type="button"
                  class="grid h-9 w-9 place-items-center rounded-lg ring-1 ring-gray-300 hover:bg-gray-50 cursor-pointer transition-all duration-200"
                  data-action="click->modal#open"
                  onclick="event.stopPropagation();"
                  aria-label="数量を記録">
            <i class="fa-solid fa-pencil"></i>
          </button>

          <%= render "tasks/modals/log_amount", task: task %>
        </div>
      <% end %>
    </div>
  </div>
</div>