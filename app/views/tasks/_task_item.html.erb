<!-- Task Card -->
<div class="group/task relative">
  <!-- Subtle glow effect on hover -->
  <div class="absolute -inset-0.5 bg-gradient-to-br from-slate-200/40 to-slate-300/40 rounded-2xl blur opacity-0 group-hover/task:opacity-10 transition duration-300"></div>

  <div class="relative bg-white rounded-2xl border border-slate-100/80 shadow-sm hover:shadow-md transition-all duration-300">
    <div class="flex items-center gap-4 px-5 py-4 md:px-6">
      <%= link_to edit_task_path(task), class: "flex items-center gap-4 flex-1 min-w-0 group/link" do %>
        <!-- 左：タイトル -->
        <div class="min-w-0 flex-1">
          <div class="text-base font-bold text-gray-900 truncate group-hover/link:text-gray-700 transition-colors">
            <%= task.title %>
          </div>
        </div>

        <!-- 中央：タグ -->
        <% if task.respond_to?(:tag) && task.tag.present? %>
          <div class="hidden md:flex items-center">
            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl bg-gradient-to-br from-indigo-50 to-indigo-100/50 border border-indigo-100/60 text-xs font-bold tracking-wide text-indigo-700 shadow-sm">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
              </svg>
              <%= task.tag %>
            </span>
          </div>
        <% end %>

        <!-- 中央：目標 -->
        <% if task.target_value.present? && task.target_unit.present? && task.target_period.present? %>
          <div class="hidden lg:flex items-center gap-2 px-3 py-1.5 rounded-xl bg-gradient-to-br from-yellow-50 to-yellow-100/50 border border-yellow-100/60">
            <svg class="w-4 h-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-xs font-bold text-yellow-800">
              目標：<%= task.target_value %><%= t("enums.task.target_unit.#{task.target_unit}") %> / <%= t("enums.task.target_period.#{task.target_period}") %>
            </span>
          </div>
        <% end %>
      <% end %>

      <!-- 右：操作（checkbox or log） -->
      <div class="shrink-0">
        <% if task.todo? || (task.habit? && task.checkbox?) %>
          <%= form_with model: task, url: complete_task_path(task), method: :patch, html: { class: "inline-block" } do |f| %>
            <%= f.check_box :status,
                { class: "h-10 w-10 rounded-xl border-2 border-gray-200
                          text-green-500 hover:border-green-300
                          focus:ring-4 focus:ring-green-100
                          transition-all duration-200 cursor-pointer
                          shadow-sm hover:shadow",
                  onclick: "event.stopPropagation(); this.form.requestSubmit();"
                },
                "done",
                "open"
            %>
          <% end %>
        <% elsif task.habit? && task.log? %>
          <div data-controller="modal">
            <button type="button"
                    class="flex items-center justify-center h-10 w-10 rounded-xl
                           bg-gradient-to-br from-emerald-50 to-emerald-100/50
                           border border-emerald-100/60
                           text-emerald-700 hover:from-emerald-100 hover:to-emerald-200/50
                           shadow-sm hover:shadow transition-all duration-200
                           cursor-pointer group/btn"
                    data-action="click->modal#open"
                    onclick="event.stopPropagation();"
                    aria-label="数量を記録">
              <svg class="w-4 h-4 group-hover/btn:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
              </svg>
            </button>

            <%= render "tasks/modals/log_amount", task: task %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>